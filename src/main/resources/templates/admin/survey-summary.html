<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>集計</title>
	<link rel="stylesheet" th:href="@{/css/common.css}">
	
	<style>
	    .tbl {
	      width: 100%;
	      border-collapse: collapse;
	      font-size: 14px;
	    }

	    .tbl th,
	    .tbl td {
	      padding: 6px 8px;
	      border-bottom: 1px solid #333;
	      text-align: right;
	    }

	    .tbl th {
	      border-bottom: 2px solid #333;
	      text-align: center;
	    }

	    .tbl td:first-child,
	    .tbl td:nth-child(2) {
	      text-align: left;
	    }

	    .tbl tbody tr:hover {
	      background: #fafafa;
	    }
	  </style>
	
</head>

<body>

	<div th:replace="fragments/admin-header :: header"></div>

	<div class="container">
		<h1 class="page-title">集計結果</h1>

		<div class="card">
			<div class="muted" style="margin-bottom: 6px;">アンケート名：</div>
			<div style="font-weight:800; font-size:18px;">
				<span th:text="${survey.title}">アンケート①</span>
			</div>
			<div class="muted" style="margin-top: 6px;">ID: <span th:text="${survey.surveyId}">1</span></div>
		</div>

		<div class="card tabs">

			<!-- Tab radios -->
			<input type="radio" name="tab" id="tab-basic" checked>
			<input type="radio" name="tab" id="tab-scales">
			<input type="radio" name="tab" id="tab-graph">

			<!-- Tab labels -->
			<div class="tab-labels">
				<label class="tab-label" for="tab-basic">基本分析</label>
				<label class="tab-label" for="tab-scales">下位尺度分析</label>
				<label class="tab-label" for="tab-graph">グラフ</label>
			</div>

			<!-- Panels -->
			<div class="tab-panels">

				<!-- 基本分析 -->
				<section class="tab-panel" id="panel-basic">

					<h2 class="section-title">設問ごとの回答数</h2>
					<div class="scroll-box" style="max-height: 260px;">
						<table class="table">
							<thead>
								<tr>
									<th class="nowrap">順序</th>
									<th>設問</th>
									<th class="nowrap">回答数</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="q : ${questionCounts}">
									<td class="nowrap" th:text="${q.displayOrder}"></td>
									<td th:text="${q.questionText}"></td>
									<td class="nowrap" th:text="${q.answerCount}"></td>
								</tr>
							</tbody>
						</table>
					</div>

					<div style="height: 14px;"></div>

					<h2 class="section-title">選択肢ごとの人数</h2>

					<div class="scroll-box" style="max-height: 520px;">
						<div th:each="entry : ${optionCountMap}" style="margin-bottom: 10px;">
							<details class="summary">
								<summary>
									<div class="summary-line">
										<span class="summary-qno"
											th:text="${entry.value[0].questionOrder + '.'}">1.</span>
										<span class="summary-text" th:text="${entry.value[0].questionText}">...</span>
									</div>
								</summary>

								<div class="scroll-box" style="max-height: 220px; margin-top: 8px;">
									<table class="table">
										<thead>
											<tr>
												<th>選択肢</th>
												<th class="nowrap">人数</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="r : ${entry.value}">
												<td th:text="${r.optionOrder + '. ' + r.optionText}"></td>
												<td class="nowrap" th:text="${r.selectedCount}"></td>
											</tr>
										</tbody>
									</table>
								</div>
							</details>
						</div>
					</div>


					<div style="height: 14px;"></div>

					<h2 class="section-title">平均スコア（SINGLE）</h2>
					<div class="scroll-box" style="max-height: 260px;">
						<table class="table">
							<thead>
								<tr>
									<th class="nowrap">順序</th>
									<th>設問</th>
									<th class="nowrap">平均</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="a : ${avgScores}">
									<td class="nowrap" th:text="${a.displayOrder}"></td>
									<td th:text="${a.questionText}"></td>
									<td class="nowrap" th:text="${#numbers.formatDecimal(a.avgScore, 1, 2)}"></td>
								</tr>
							</tbody>
						</table>
					</div>

				</section>

				<!-- 下位尺度分析（いまはプレースホルダ） -->
				<section class="tab-panel" id="panel-scales">


					<h2>下位尺度（COMPLETEDのみ）</h2>

					<div class="table-wrap">
					  <table class="tbl">
					    <thead>
					      <tr>
					        <th style="width: 120px;">コード</th>
					        <th>尺度名</th>
					        <th style="width: 80px; text-align: right;">N</th>
					        <th style="width: 110px; text-align: right;">平均</th>
					        <th style="width: 110px; text-align: right;">SD</th>
					        <th style="width: 110px; text-align: right;">中央値</th>
					      </tr>
					    </thead>

					    <tbody>
					      <tr th:if="${scaleAvgs == null || #lists.isEmpty(scaleAvgs)}">
					        <td colspan="6" class="muted">下位尺度データがありません（回答がない、または尺度設定が未投入の可能性があります）</td>
					      </tr>

					      <tr th:each="s : ${scaleAvgs}">
					        <td th:text="${s.scaleCode}">S1</td>
					        <td th:text="${s.scaleName}">尺度名</td>

					        <td style="text-align: right;" th:text="${s.respondentCount}">0</td>

					        <td style="text-align: right;"
					            th:text="${s.avgScore == null ? '-' : #numbers.formatDecimal(s.avgScore, 1, 2)}">-</td>

					        <td style="text-align: right;"
					            th:text="${s.sdScore == null ? '-' : #numbers.formatDecimal(s.sdScore, 1, 2)}">-</td>

					        <td style="text-align: right;"
					            th:text="${s.medianScore == null ? '-' : #numbers.formatDecimal(s.medianScore, 1, 2)}">-</td>
					      </tr>
					    </tbody>
					  </table>
					</div>

				</section>

				<!-- グラフ（いまはプレースホルダ） -->
				<section class="tab-panel" id="panel-graph">
					<p class="muted">※ここに下位尺度別の棒グラフを表示します（次のステップ）。</p>
				</section>

			</div>
		</div>

		<div style="margin-top: 14px;">
			<a th:href="@{'/admin/surveys/' + ${survey.surveyId}}">アンケート詳細に戻る</a>
		</div>

	</div>
</body>

</html>