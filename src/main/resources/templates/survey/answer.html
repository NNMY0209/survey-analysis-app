<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>アンケート回答</title>
</head>

<body>

	<h1>アンケート回答</h1>

	<!-- 回答送信フォーム -->
	<form method="post" th:action="@{|/survey/${vm.surveyId}/submit|}">

		<!-- セッション識別（必須） -->
		<input type="hidden" name="surveyId" th:value="${vm.surveyId}" />
		<input type="hidden" name="responseId" th:value="${vm.responseId}" />

		<!-- 設問ループ -->
		<div th:each="q, stat : ${vm.questions}" style="margin-bottom: 24px;">

			<h3 th:text="${q.questionText}">設問テキスト</h3>

			<!-- DTOバインド用：設問IDと種別 -->
			<input type="hidden" th:name="${'answers[' + stat.index + '].questionId'}" th:value="${q.questionId}" />
			<input type="hidden" th:name="${'answers[' + stat.index + '].questionType'}" th:value="${q.questionType}" />

			<!-- SINGLE：ラジオ -->
			<div th:if="${q.questionType == 'SINGLE'}">
				<div th:each="opt : ${q.options}">
					<label>
						<input type="radio" th:name="${'answers[' + stat.index + '].optionId'}"
							th:value="${opt.optionId}" />
						<span th:text="${opt.optionText}">選択肢</span>
					</label>
				</div>
			</div>

			<!-- MULTI：チェックボックス -->
			<div th:if="${q.questionType == 'MULTI'}">
				<div th:each="opt : ${q.options}">
					<label>
						<input type="checkbox" th:name="${'answers[' + stat.index + '].optionIds'}"
							th:value="${opt.optionId}" />
						<span th:text="${opt.optionText}">選択肢</span>
					</label>
				</div>
			</div>

			<!-- TEXT：もし将来追加したらここで入力できる（今のDBにはTEXT設問がないので表示されない） -->
			<div th:if="${q.questionType == 'TEXT'}">
				<textarea th:name="${'answers[' + stat.index + '].answerText'}" rows="4" cols="40"
					placeholder="自由に入力してください"></textarea>
			</div>

		</div>

		<button type="submit">送信</button>
	</form>

</body>

</html>